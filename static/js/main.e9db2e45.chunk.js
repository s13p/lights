(this["webpackJsonp@login-with-metamask/frontend"]=this["webpackJsonp@login-with-metamask/frontend"]||[]).push([[0],{117:function(e,t,n){},120:function(e,t){},125:function(e,t){},127:function(e,t){},137:function(e,t){},139:function(e,t){},165:function(e,t){},166:function(e,t){},171:function(e,t){},173:function(e,t){},180:function(e,t){},199:function(e,t){},220:function(e,t,n){},221:function(e,t,n){},223:function(e,t,n){},227:function(e,t,n){"use strict";n.r(t);n(117);var o,a=n(113),c=n(9),i=n(114),r=n.n(i),s=n(23),u=(n(220),n(29)),d=n(58),l=(n(221),n(115)),b=n.n(l),h=n(2),O=function(e){var t=e.onLoggedIn,n=Object(c.useState)(!1),a=Object(s.a)(n,2),i=a[0],r=a[1],l=function(e){var t=e.publicAddress,n=e.signature;return fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"/login-with-metamask",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BACKEND_URL,"/auth"),{body:JSON.stringify({publicAddress:t,signature:n}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){return e.json()}))},O=function(){var e=Object(d.a)(Object(u.a)().mark((function e(t){var n,a,c;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.publicAddress,a=t.nonce,e.prev=1,e.next=4,o.eth.personal.sign("I am signing my one-time nonce: ".concat(a),n,"");case 4:return c=e.sent,e.abrupt("return",{publicAddress:n,signature:c});case 8:throw e.prev=8,e.t0=e.catch(1),new Error("You need to sign the message to be able to log in.");case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),j=function(e){return fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"/login-with-metamask",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BACKEND_URL,"/users"),{body:JSON.stringify({publicAddress:e}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){return e.json()}))},f=function(){var e=Object(d.a)(Object(u.a)().mark((function e(){var n,a;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum){e.next=3;break}return window.alert("Please install MetaMask first."),e.abrupt("return");case 3:if(o){e.next=14;break}return e.prev=4,e.next=7,window.ethereum.enable();case 7:o=new b.a(window.ethereum),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),window.alert("You need to allow MetaMask."),e.abrupt("return");case 14:return e.next=16,o.eth.getCoinbase();case 16:if(n=e.sent){e.next=20;break}return window.alert("Please activate MetaMask first."),e.abrupt("return");case 20:a=n.toLowerCase(),r(!0),fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"/login-with-metamask",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BACKEND_URL,"/users?publicAddress=").concat(a)).then((function(e){return e.json()})).then((function(e){return e.length?e[0]:j(a)})).then(O).then(l).then(t).catch((function(e){window.alert(e),r(!1)}));case 23:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(){return e.apply(this,arguments)}}();return Object(h.jsxs)("div",{children:[Object(h.jsxs)("p",{children:["Please select your login method.",Object(h.jsx)("br",{}),"For the purpose of this demo, only MetaMask login is implemented."]}),Object(h.jsx)("button",{className:"Login-button Login-mm",onClick:f,children:i?"Loading...":"Login with MetaMask"}),Object(h.jsx)("button",{className:"Login-button Login-fb",disabled:!0,children:"Login with Facebook"}),Object(h.jsx)("button",{className:"Login-button Login-email",disabled:!0,children:"Login with Email"})]})},j=n(10),f=(n(223),n(59)),p=n(116),g=n.n(p),m=function(e){var t=e.auth,n=e.onLoggedOut,o=Object(c.useState)({loading:!1,user:void 0,username:""}),a=Object(s.a)(o,2),i=a[0],r=a[1];Object(c.useEffect)((function(){var e=t.accessToken,n=Object(f.a)(e).payload.id;fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"/login-with-metamask",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BACKEND_URL,"/users/").concat(n),{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).then((function(e){return r((function(t){return Object(j.a)(Object(j.a)({},t),{},{user:e})}))})).catch(window.alert)}),[t]);var u=t.accessToken,d=Object(f.a)(u).payload.publicAddress,l=i.loading,b=i.user,O=b&&b.username;return Object(h.jsxs)("div",{className:"Profile",children:[Object(h.jsxs)("p",{children:["Logged in as ",Object(h.jsx)(g.a,{seed:d})]}),Object(h.jsxs)("div",{children:["My username is ",O?Object(h.jsx)("pre",{children:O}):"not set."," ","My publicAddress is ",Object(h.jsx)("pre",{children:d})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"username",children:"Change username: "}),Object(h.jsx)("input",{name:"username",onChange:function(e){var t=e.target.value;r(Object(j.a)(Object(j.a)({},i),{},{username:t}))}}),Object(h.jsx)("button",{disabled:l,onClick:function(){var e=t.accessToken,n=i.user,o=i.username;r(Object(j.a)(Object(j.a)({},i),{},{loading:!0})),n?fetch("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"/login-with-metamask",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BACKEND_URL,"/users/").concat(n.id),{body:JSON.stringify({username:o}),headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},method:"PATCH"}).then((function(e){return e.json()})).then((function(e){return r(Object(j.a)(Object(j.a)({},i),{},{loading:!1,user:e}))})).catch((function(e){window.alert(e),r(Object(j.a)(Object(j.a)({},i),{},{loading:!1}))})):window.alert("The user id has not been fetched yet. Please try again in 5 seconds.")},children:"Submit"})]}),Object(h.jsx)("p",{children:Object(h.jsx)("button",{onClick:n,children:"Logout"})})]})},_=n.p+"static/media/logo.103b5fa1.svg",S="login-with-metamask:auth",E=function(){var e=Object(c.useState)({}),t=Object(s.a)(e,2),n=t[0],o=t[1];Object(c.useEffect)((function(){var e=window.localStorage.getItem(S),t=e&&JSON.parse(e);o({auth:t})}),[]);var a=n.auth;return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsxs)("header",{className:"App-header",children:[Object(h.jsx)("img",{src:_,className:"App-logo",alt:"logo"}),Object(h.jsx)("h1",{className:"App-title",children:"Welcome to Login with MetaMask Demo"})]}),Object(h.jsx)("div",{className:"App-intro",children:a?Object(h.jsx)(m,{auth:a,onLoggedOut:function(){localStorage.removeItem(S),o({auth:void 0})}}):Object(h.jsx)(O,{onLoggedIn:function(e){localStorage.setItem(S,JSON.stringify(e)),o({auth:e})}})})]})};Object(a.config)({path:".env.production"}),r.a.render(Object(h.jsx)(E,{}),document.getElementById("root"))}},[[227,1,2]]]);
//# sourceMappingURL=main.e9db2e45.chunk.js.map